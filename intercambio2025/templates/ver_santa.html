{% extends "base.html" %}

{% block content %}
<div class="santa-container">
    <h2>Mi carta a Santa Claus</h2>
    
    <div class="info-box">
        <h3>Tu informaci贸n:</h3>
        <p><strong>Nombre:</strong> {{ usuario.nombre }}</p>
        <p><strong>Usuario:</strong> #{{ usuario.id }}</p>
        <p><strong>Jefa o jefe de Familia:</strong> {{ usuario.jefe_familia }}</p>
        <p><strong>Tu presupuesto:</strong> ${{ "%.2f"|format(usuario.presupuesto_min) }} - ${{ "%.2f"|format(usuario.presupuesto_max) }}</p>
        <p><strong>{{ usuario.navidad_tepoztlan }} pasar茅 Navidad en Tepoztl谩n.</strong></p>
    </div>
    
    {% if santa_claus %}
    <div class="info-box success">
        <h3> Tu Santa Claus:</h3>
        <p><strong>Presupuesto de tu Santa Claus:</strong> ${{ "%.2f"|format(santa_claus.presupuesto_min) }} - ${{ "%.2f"|format(santa_claus.presupuesto_max) }}</p>
        <p class="note">Tu Santa Claus es an贸nimo. Solo puedes ver su rango de presupuesto.</p>
    </div>
    
    <div class="form-container">
        <h3>Carta a Santa Claus: <br> <br> </h3>
        <form method="POST" action="{{ url_for('proponer_regalos') }}" class="form">
            <div class="form-group">
                <label for="opcion1">Opci贸n 1:</label>
                <input type="text" id="opcion1" name="opcion1" required 
                       value="{{ regalos.opcion1 if regalos else '' }}" 
                       placeholder="Bicicleta">
            </div>
            
            <div class="form-group">
                <label for="opcion2">Opci贸n 2:</label>
                <input type="text" id="opcion2" name="opcion2" required 
                       value="{{ regalos.opcion2 if regalos else '' }}" 
                       placeholder="Pelota">
            </div>
            
            <div class="form-group">
                <label for="opcion3">Opci贸n 3:</label>
                <input type="text" id="opcion3" name="opcion3" required 
                       value="{{ regalos.opcion3 if regalos else '' }}" 
                       placeholder="Valero">
            </div>
            
            <button type="submit" class="btn btn-primary">
                {% if regalos %}Reenviar carta{% else %}Enviar carta{% endif %}
            </button>
        </form>
        
        {% if regalos %}
        <div class="info-box" style="margin-top: 20px;">
            <h4>Carta actual:</h4>
            <ol>
                <li>{{ regalos.opcion1 }}</li>
                <li>{{ regalos.opcion2 }}</li>
                <li>{{ regalos.opcion3 }}</li>
            </ol>
        </div>
        {% endif %}
    </div>
    
    <!-- Secci贸n de Mensajer铆a -->
    <div class="mensajeria-section" style="margin-top: 30px; border-top: 2px solid #ddd; padding-top: 20px;">
        <h3> Mensaje a Santa Claus</h3>
        
        <!-- Mensajes del Santa al Usuario -->
        {% if mensajes_santa %}
        <div class="mensajes-recibidos" style="margin-bottom: 20px;">
            <h4>Mensajes de tu Santa Claus:</h4>
            {% for mensaje in mensajes_santa %}
            <div class="mensaje-card" style="background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #2196F3;">
                <p style="margin: 0 0 5px 0;">{{ mensaje.mensaje }}</p>
                <small style="color: #666;">{{ mensaje.fecha_envio.strftime('%d/%m/%Y %H:%M') }}</small>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="info-box" style="margin-bottom: 20px;">
            <p>No has recibido mensajes de tu Santa Claus a煤n.</p>
        </div>
        {% endif %}
        
        <!-- Mensajes del Usuario al Santa -->
        {% if mensajes_usuario %}
        <div class="mensajes-enviados" style="margin-bottom: 20px;">
            <h4>Mensajes que enviaste:</h4>
            {% for mensaje in mensajes_usuario %}
            <div class="mensaje-card" style="background: #f3e5f5; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #9C27B0;">
                <p style="margin: 0 0 5px 0;">{{ mensaje.mensaje }}</p>
                <small style="color: #666;">{{ mensaje.fecha_envio.strftime('%d/%m/%Y %H:%M') }}</small>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Formulario para enviar mensaje -->
        <div class="form-container">
            <h4>Enviar mensaje a tu Santa Claus:</h4>
            <form method="POST" action="{{ url_for('enviar_mensaje') }}" class="form">
                <input type="hidden" name="destinatario_id" value="{{ santa_claus.id }}">
                <div class="form-group">
                    <label for="mensaje">Tu mensaje:</label>
                    <textarea id="mensaje" name="mensaje" rows="4" required 
                              placeholder="Escribe tu mensaje an贸nimo a tu Santa Claus aqu铆..." 
                              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit;"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Enviar</button>
            </form>
        </div>
    </div>
    {% else %}
    <div class="info-box warning">
        <p>锔 A煤n no se ha realizado el sorteo. Tu Santa Claus ser谩 asignado cuando se realice el sorteo.</p>
        <p>Puedes ver el estado del sorteo en la p谩gina de <a href="{{ url_for('sorteo') }}">Sorteo</a>.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

