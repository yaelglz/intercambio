{% extends "base.html" %}

{% block content %}
<div class="regalos-container">
    <h2>Opciones de Regalo</h2>
    
    <div class="info-box">
        <h3>游꾼游낖 Santa Claus: {{ santa_claus.nombre }}</h3>
        <!--<p><strong>Tu presupuesto:</strong> ${{ "%.2f"|format(santa_claus.presupuesto_min) }} - ${{ "%.2f"|format(santa_claus.presupuesto_max) }}</p>-->
    </div>
    
    {% if usuarios_con_regalos %}
    <div class="regalos-list">
        {% for item in usuarios_con_regalos %}
        <div class="regalo-card">
            <h3>
                {% if item.mostrar_nombre %}
                    Usuario: {{ item.usuario.nombre }}
                {% else %}
                    Usuario #{{ item.usuario.id }}
                {% endif %}
            </h3>
            
            <div class="usuario-info">
                <!--<p><strong>Presupuesto del usuario:</strong> ${{ "%.2f"|format(item.usuario.presupuesto_min) }} - ${{ "%.2f"|format(item.usuario.presupuesto_max) }}</p>-->
                {% if item.mostrar_nombre %}
                    <p class="note">Esta persona no pasar치 Navidad en Tepoztl치n, por lo tanto puedes conocer su identidad.</p>
                {% else %}
                    <p class="note">Este persona pasar치 Navidad en Tepoztl치n, por lo tanto su identidad es an칩nima.</p>
                {% endif %}
            </div>
            
            {% if item.regalos %}
            <div class="opciones-regalo">
                <h4>Opciones de regalo propuestas:</h4>
                <ol>
                    <li>{{ item.regalos.opcion1 }}</li>
                    <li>{{ item.regalos.opcion2 }}</li>
                    <li>{{ item.regalos.opcion3 }}</li>
                </ol>
            </div>
            {% else %}
            <div class="warning-box">
                <p>丘멆잺 Este usuario a칰n no ha propuesto sus opciones de regalo.</p>
            </div>
            {% endif %}
            
            <!-- Secci칩n de Mensajer칤a -->
            <div class="mensajeria-section" style="margin-top: 20px; border-top: 2px solid #ddd; padding-top: 15px;">
                <h4>游눫 Mensaje de Santa Claus:</h4>
                
                <!-- Mensajes del Santa al Usuario -->
                {% if item.mensajes_santa %}
                <div class="mensajes-enviados" style="margin-bottom: 15px;">
                    <h5>Mensajes que enviaste:</h5>
                    {% for mensaje in item.mensajes_santa %}
                    <div class="mensaje-card" style="background: #e3f2fd; padding: 10px; margin: 5px 0; border-radius: 5px;">
                        <p style="margin: 0;">{{ mensaje.mensaje }}</p>
                        <small style="color: #666;">{{ mensaje.fecha_envio.strftime('%d/%m/%Y %H:%M') }}</small>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <!-- Mensajes del Usuario al Santa -->
                {% if item.mensajes_usuario %}
                <div class="mensajes-recibidos" style="margin-bottom: 15px;">
                    <h5>Mensajes recibidos:</h5>
                    {% for mensaje in item.mensajes_usuario %}
                    <div class="mensaje-card" style="background: #f3e5f5; padding: 10px; margin: 5px 0; border-radius: 5px;">
                        <p style="margin: 0;">{{ mensaje.mensaje }}</p>
                        <small style="color: #666;">{{ mensaje.fecha_envio.strftime('%d/%m/%Y %H:%M') }}</small>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                <!-- Formulario para enviar mensaje -->
                <form method="POST" action="{{ url_for('enviar_mensaje') }}" class="form">
                    <input type="hidden" name="destinatario_id" value="{{ item.usuario.id }}">
                    <div class="form-group">
                        <label for="mensaje_{{ item.usuario.id }}">Enviar mensaje:</label>
                        <textarea id="mensaje_{{ item.usuario.id }}" name="mensaje" rows="3" required 
                                  placeholder="Escribe tu mensaje an칩nimo aqu칤..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="margin-top: 5px;">Enviar</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="info-box warning">
        <p>丘멆잺 A칰n no tienes usuarios asignados como tu Santa Claus. El sorteo debe realizarse primero.</p>
        <p>Puedes ver el estado del sorteo en la p치gina de <a href="{{ url_for('sorteo') }}">Sorteo</a>.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

